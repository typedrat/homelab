apiVersion: v1
kind: ConfigMap
metadata:
    name: prowlarr-config-template
    namespace: media
data:
    config.xml: |
        <Config>
            <LogLevel>info</LogLevel>
            <EnableSsl>False</EnableSsl>
            <Port>9000</Port>
            <SslPort>9443</SslPort>
            <UrlBase></UrlBase>
            <BindAddress>*</BindAddress>
            <ApiKey></ApiKey>
            <AuthenticationMethod>External</AuthenticationMethod>
            <UpdateMechanism>Docker</UpdateMechanism>
            <LaunchBrowser>True</LaunchBrowser>
            <Branch>main</Branch>
            <InstanceName>Prowlarr</InstanceName>
            <SyslogPort>514</SyslogPort>
            <AuthenticationRequired>Enabled</AuthenticationRequired>
            <SslCertPath></SslCertPath>
            <SslCertPassword></SslCertPassword>
        </Config>
    setup.sh: |
        #!/bin/sh
        if [ ! -f /config/config.xml ]; then
            cp /template/config.xml /config/config.xml
        fi
        dasel put -f /config/config.xml -t string -v "External" "Config.AuthenticationMethod"
        dasel put -f /config/config.xml -t string -v "${API_KEY}" "Config.ApiKey"
