---
apiVersion: batch/v1
kind: CronJob
metadata:
    name: configarr
spec:
    schedule: "0 * * * *"
    successfulJobsHistoryLimit: 1
    failedJobsHistoryLimit: 1
    jobTemplate:
        spec:
            template:
                spec:
                    containers:
                        - name: configarr
                          image: ghcr.io/raydak-labs/configarr:latest
                          imagePullPolicy: Always
                          tty: true
                          volumeMounts:
                              - name: configarr-cache
                                mountPath: /app/repos
                              - name: config-volume
                                mountPath: /app/config/config.yml
                                subPath: config.yml
                              - name: secret-volume
                                mountPath: /app/config/secrets.yml
                                subPath: secrets.yml
                    volumes:
                        - name: configarr-cache
                          persistentVolumeClaim:
                              claimName: configarr-cache
                        - name: config-volume
                          configMap:
                              name: configarr
                        - name: secret-volume
                          secret:
                              secretName: arr-api-keys
                    restartPolicy: Never
